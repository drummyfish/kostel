<html>


<head>
  <style>
    body
      {
        margin: 0;
        padding: 0;
      }
  </style>

  <meta charset="utf-8">
  <!-- 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.9.0/jquery-ui.min.js"></script>
  -->
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css">
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
  
  
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <script src="js/bootstrap.min.js"></script>



  <script>



  var bg_offset = 0;
  var mouse_x, mouse_y;
  var player_y,player_x;

  player_y = 0;
  player_x = 0;

  var enemies = Array();
  var enemies_positions = Array();
  var enemies_speeds = Array();

  function handleMouseMove(event)
    {
      //event = event || window.event; // IE-ism	  
      mouse_x = event.clientX - 100;
      mouse_y = event.clientY - 70;
	  
	  //console.log('x=' +  mouse_x + ' y=mouse_y' + mouse_y);
    }
	
	  function handleTouch(event)
    {
      //event = event || window.event; // IE-ism	  
      mouse_x = event.touches[0].pageX; - 100;
	  mouse_y = event.touches[0].pageY; - 70;
	  
	  //console.log('x=' +  mouse_x + ' y=' + mouse_y);
    }

	
	
  function init()
    {
      setInterval(function(){frame()}, 20);
      //window.onmousemove = handleMouseMove;							!!
	  window.ontouchmove = handleTouch;
	  window.onmousemove = handleMouseMove;
      setTimeout(create_enemy,2000);
    }

  function frame()
    {
      document.getElementById("bg_layer1").style.background = "url(images/game_back.png) repeat " + bg_offset + "px";
      bg_offset -= 1;
      document.getElementById("bg_layer2").style.background = "url(images/game_back2.png) repeat " + (bg_offset * 2) + "px";
      bg_offset -= 1;

      player_y = mouse_y;
      player_x = mouse_x;

      if (player_y > 800)
        player_y = 800;
      else if (player_y < 30)
        player_y = 30;

      if (player_x > 500)
        player_x = 500;
      else if (player_x < 40)
        player_x = 40;

      document.getElementById("player").style.top = player_y + "px";
      document.getElementById("player").style.left = player_x + "px";

      for (i = 0; i < enemies.length; i++)
        {
          if (enemies[i] == null)
            continue;

          enemies_positions[i] += enemies_speeds[i];
          enemies[i].style.right = enemies_positions[i] + "px";

          if (enemies_positions[i] > $(window).width() - 200)
            {
              enemies[i].parentNode.removeChild(enemies[i]);
			  enemies[i].remove();			  
              enemies[i] = null;
              continue;
            }

          // colission detection:

          var rect = enemies[i].getBoundingClientRect();
          var center_x = rect.left + 64;
          var center_y = rect.top + 10;

          var dx = center_x - player_x;
          var dy = center_y - player_y;

          var distance_to_player = Math.sqrt(dx * dx + dy * dy);

          if (distance_to_player < 64)
            {
               enemies[i].src = "images/explosion.gif";
            }
        }
    }

  function create_enemy()
    {
      if (enemies.length >= 20000)
        return;

      var img = document.createElement('img');

      var rand = Math.random();

      if (rand > 0.75)
        img.src = "images/devil.png";
      else if (rand > 0.10)
        img.src = "images/meteor.gif";
      else if (rand > 0.05)
        img.src = "images/darvin.png";
      else
        img.src = "images/pokemon.png";

      img.style.zIndex = "20";
      img.style.position = "absolute";
      img.style.top = Math.round(Math.random() * 80) + "%";
      img.style.right = "20px";
      document.body.appendChild(img);

      enemies[enemies.length] = img;
      enemies_positions[enemies_positions.length] = 20;
      enemies_speeds[enemies_speeds.length] = 5 + Math.round(Math.random() * 18);

      setTimeout(create_enemy,Math.random() * 800);
    }

  </script>
</head>



<body onload="init();">

	<script language="javascript" type="text/javascript">
	document.oncontextmenu=RightMouseDown;
	document.onmousedown = mouseDown; 

	function mouseDown(e) {
	}
	function RightMouseDown() { return false;}
	</script>
	
	<script>
	/*
	node.addEventListener('gestureend', function(e) {
if (e.scale < 1.0) {
// User moved fingers closer together
} else if (e.scale > 1.0) {
// User moved fingers further apart
}
}, false);
*/
	
	</script>

  <img id="player" src="images/jesus.gif" style="position: absolute; z-index: 20;" />

  <a href="kostel.html"></a><button type="button" class="btn btn-primary" style="z-index: 50; position: absolute; right: 20px; bottom: 20px;"> zpÄ›t </button></a>

  <div id="bg_layer2" style="position: absolute; min-width: 100%; min-height: 100%; background: url(images/game_back2.png) repeat 0px"></div>
  <div id="bg_layer1" style="min-width: 100%; min-height: 100%; background: url(images/game_back.png) repeat 0px"></div>

</body>


</html>
